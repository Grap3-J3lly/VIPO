[gd_scene load_steps=31 format=3 uid="uid://bnpalqwvitydn"]

[ext_resource type="Script" uid="uid://c1elghljr43o3" path="res://Managers/GameManager.cs" id="1_gq68b"]
[ext_resource type="Material" uid="uid://c6nwl1bilw4q5" path="res://Scenes/Common/Materials/grid1_mat.tres" id="1_yyr2h"]
[ext_resource type="PackedScene" uid="uid://dk12kh4yartby" path="res://Entities/Characters/Player/character.tscn" id="2_7mwck"]
[ext_resource type="Script" uid="uid://bw82bk66msksh" path="res://Managers/AIManager.cs" id="3_nejqq"]
[ext_resource type="Script" uid="uid://dtkvuughijj3i" path="res://Managers/CameraManager.cs" id="3_oajfl"]
[ext_resource type="Script" uid="uid://bc6djna7rdixf" path="res://External/WSClient.gd" id="3_uwo22"]
[ext_resource type="Material" uid="uid://cbb58vp1qan7t" path="res://Scenes/Common/Materials/screen_render_mat.tres" id="4_pkdba"]
[ext_resource type="Script" uid="uid://bi4mrwrng6lpd" path="res://Managers/AudioManager.cs" id="5_uyabo"]
[ext_resource type="Script" uid="uid://cklwrqcqsukq5" path="res://Scenes/Main/RenderScreen.cs" id="7_5mnbt"]
[ext_resource type="Script" uid="uid://clsfjtih1nqsm" path="res://Entities/Characters/Player/MainCameraController.cs" id="7_6m2wv"]
[ext_resource type="VideoStream" uid="uid://dunwcl33mjs7w" path="res://Assets/BRB.ogv" id="7_6872q"]
[ext_resource type="PackedScene" uid="uid://ckge4vx8gbymo" path="res://Entities/Characters/Familiar/familiar.tscn" id="12_fxe8t"]
[ext_resource type="Script" uid="uid://b6byku3oeclnj" path="res://Managers/ObjectPool.cs" id="13_ack1u"]

[sub_resource type="AudioStreamMicrophone" id="AudioStreamMicrophone_x6vxh"]

[sub_resource type="WorldBoundaryShape3D" id="WorldBoundaryShape3D_htw3l"]

[sub_resource type="NavigationMesh" id="NavigationMesh_h8on7"]
vertices = PackedVector3Array(-49.5, 0.2, -49.5, -49.5, 0.2, 49.5, 49.5, 0.2, 49.5, 49.5, 0.2, -49.5)
polygons = [PackedInt32Array(3, 2, 0), PackedInt32Array(0, 2, 1)]
cell_height = 0.1

[sub_resource type="PlaneMesh" id="PlaneMesh_qy4e4"]
size = Vector2(100, 100)

[sub_resource type="BoxMesh" id="BoxMesh_px750"]
material = ExtResource("1_yyr2h")

[sub_resource type="BoxShape3D" id="BoxShape3D_ly3nc"]

[sub_resource type="BoxShape3D" id="BoxShape3D_b375f"]

[sub_resource type="BoxShape3D" id="BoxShape3D_hvnqh"]

[sub_resource type="BoxShape3D" id="BoxShape3D_3q760"]

[sub_resource type="ProceduralSkyMaterial" id="ProceduralSkyMaterial_m50ur"]
sky_top_color = Color(0.30532, 0.55232, 0.799444, 1)
sky_horizon_color = Color(0.490803, 0.532479, 0.425904, 1)
sky_energy_multiplier = 1.3
ground_bottom_color = Color(0.103115, 0.202673, 0.0998636, 1)

[sub_resource type="Sky" id="Sky_ht0q2"]
sky_material = SubResource("ProceduralSkyMaterial_m50ur")

[sub_resource type="Environment" id="Environment_t8j3o"]
background_mode = 2
sky = SubResource("Sky_ht0q2")

[sub_resource type="StandardMaterial3D" id="StandardMaterial3D_4idki"]
resource_local_to_scene = true

[sub_resource type="QuadMesh" id="QuadMesh_1cmki"]
resource_local_to_scene = true
size = Vector2(4, 4)

[sub_resource type="QuadMesh" id="QuadMesh_lfbep"]
resource_local_to_scene = true
material = ExtResource("4_pkdba")
size = Vector2(16, 9)

[sub_resource type="ViewportTexture" id="ViewportTexture_t3k75"]
viewport_path = NodePath("RenderScreen/BRBSubviewport")

[sub_resource type="StandardMaterial3D" id="StandardMaterial3D_urje4"]
resource_local_to_scene = true
albedo_texture = SubResource("ViewportTexture_t3k75")
albedo_texture_force_srgb = true

[node name="VIPO" type="Node3D"]

[node name="GameManager" type="Node" parent="." node_paths=PackedStringArray("cameraManager", "scryArea", "environment", "objectPool")]
script = ExtResource("1_gq68b")
cameraManager = NodePath("../CameraManager")
scryArea = NodePath("../SceneEffectors/MainCamera/ScryCamArea")
charControllerScene = ExtResource("2_7mwck")
environment = NodePath("../Environment")
objectPool = NodePath("../ObjectPool")
camPos_FullScreen = Vector3(0.955, 5, 6.26)
commands = PackedStringArray("Enlarge", "Reduce", "Scry", "FindFamiliar")

[node name="AIManager" type="Node" parent="."]
script = ExtResource("3_nejqq")
mapCellSize = 0.25
mapCellHeight = 0.25

[node name="CameraManager" type="Node" parent="." node_paths=PackedStringArray("mainCamera", "scryCamSubviewport", "mainCamDefaultParent")]
script = ExtResource("3_oajfl")
mainCamera = NodePath("../SceneEffectors/MainCamera")
scryCamSubviewport = NodePath("../RenderScreen/ScryCamSubviewport")
mainCamDefaultParent = NodePath("../SceneEffectors")

[node name="StreamBotConnector" type="Node" parent="."]
script = ExtResource("3_uwo22")

[node name="ObjectPool" type="Node" parent="."]
script = ExtResource("13_ack1u")
familiarScene = ExtResource("12_fxe8t")

[node name="AudioManager" type="Node" parent="." node_paths=PackedStringArray("mic_input")]
script = ExtResource("5_uyabo")
mic_input = NodePath("Mic_StreamPlayer")
mic_VolumeCutoff = -115.0

[node name="Mic_StreamPlayer" type="AudioStreamPlayer" parent="AudioManager"]
stream = SubResource("AudioStreamMicrophone_x6vxh")
volume_db = -80.0
autoplay = true
bus = &"Mic"

[node name="Environment" type="Node" parent="."]

[node name="Floor" type="StaticBody3D" parent="Environment"]

[node name="CollisionShape3D" type="CollisionShape3D" parent="Environment/Floor"]
transform = Transform3D(10, 0, 0, 0, 10, 0, 0, 0, 10, 0, 0, 0)
shape = SubResource("WorldBoundaryShape3D_htw3l")

[node name="NavigationRegion3D" type="NavigationRegion3D" parent="Environment/Floor"]
transform = Transform3D(2, 0, 0, 0, 2, 0, 0, 0, 2, 0.08, 0, -0.125)
navigation_mesh = SubResource("NavigationMesh_h8on7")

[node name="FloorMesh" type="MeshInstance3D" parent="Environment/Floor/NavigationRegion3D"]
transform = Transform3D(1, 0, 0, 0, 0.01, 0, 0, 0, 1, 0, 0, 0)
material_override = ExtResource("1_yyr2h")
mesh = SubResource("PlaneMesh_qy4e4")
skeleton = NodePath("../..")

[node name="Wall1" type="StaticBody3D" parent="Environment"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 5, -100)

[node name="MeshInstance3D" type="MeshInstance3D" parent="Environment/Wall1"]
transform = Transform3D(200, 0, 0, 0, 10, 0, 0, 0, 2, 0, 0, 0)
material_override = ExtResource("1_yyr2h")
mesh = SubResource("BoxMesh_px750")

[node name="CollisionShape3D" type="CollisionShape3D" parent="Environment/Wall1"]
transform = Transform3D(200, 0, 0, 0, 10, 0, 0, 0, 2, 0, 0, 0)
shape = SubResource("BoxShape3D_ly3nc")

[node name="Wall2" type="StaticBody3D" parent="Environment"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 5, 100)

[node name="MeshInstance3D" type="MeshInstance3D" parent="Environment/Wall2"]
transform = Transform3D(200, 0, 0, 0, 10, 0, 0, 0, 2, 0, 0, 0)
material_override = ExtResource("1_yyr2h")
mesh = SubResource("BoxMesh_px750")

[node name="CollisionShape3D" type="CollisionShape3D" parent="Environment/Wall2"]
transform = Transform3D(200, 0, 0, 0, 10, 0, 0, 0, 2, 0, 0, 0)
shape = SubResource("BoxShape3D_b375f")

[node name="Wall3" type="StaticBody3D" parent="Environment"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, -100, 5, 0)

[node name="MeshInstance3D" type="MeshInstance3D" parent="Environment/Wall3"]
transform = Transform3D(2, 0, 0, 0, 10, 0, 0, 0, 200, 0, 0, 0)
material_override = ExtResource("1_yyr2h")
mesh = SubResource("BoxMesh_px750")

[node name="CollisionShape3D" type="CollisionShape3D" parent="Environment/Wall3"]
transform = Transform3D(2, 0, 0, 0, 10, 0, 0, 0, 200, 0, 0, 0)
shape = SubResource("BoxShape3D_hvnqh")

[node name="Wall4" type="StaticBody3D" parent="Environment"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 100, 5, 0)

[node name="MeshInstance3D" type="MeshInstance3D" parent="Environment/Wall4"]
transform = Transform3D(2, 0, 0, 0, 10, 0, 0, 0, 200, 0, 0, 0)
mesh = SubResource("BoxMesh_px750")

[node name="CollisionShape3D" type="CollisionShape3D" parent="Environment/Wall4"]
transform = Transform3D(2, 0, 0, 0, 10, 0, 0, 0, 200, 0, 0, 0)
shape = SubResource("BoxShape3D_3q760")

[node name="SceneEffectors" type="Node" parent="."]

[node name="MainCamera" type="Camera3D" parent="SceneEffectors"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, -0.401, 4.243, 7.639)
environment = SubResource("Environment_t8j3o")
fov = 60.0
script = ExtResource("7_6m2wv")
resetPosition = Vector3(-0.401, 4.243, 7.639)

[node name="ScryCamArea" type="MeshInstance3D" parent="SceneEffectors/MainCamera"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 4.862, 1.606, -6.245)
material_override = SubResource("StandardMaterial3D_4idki")
mesh = SubResource("QuadMesh_1cmki")
skeleton = NodePath("../../../RenderScreen")

[node name="THE SUN" type="DirectionalLight3D" parent="SceneEffectors"]
transform = Transform3D(0.999989, 0.000437464, -0.00464901, 0.00269217, 0.759465, 0.650543, 0.00381535, -0.650548, 0.759456, 0, 0, 0)

[node name="RenderScreen" type="Area3D" parent="." node_paths=PackedStringArray("videoPlayer", "liveMesh", "videoMesh")]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0.942, 5, -2)
script = ExtResource("7_5mnbt")
renderMat = ExtResource("4_pkdba")
videoPlayer = NodePath("BRBSubviewport/VideoStreamPlayer")
liveMesh = NodePath("LiveMesh")
videoMesh = NodePath("VideoMesh")

[node name="LiveMesh" type="MeshInstance3D" parent="RenderScreen"]
gi_mode = 0
mesh = SubResource("QuadMesh_lfbep")

[node name="VideoMesh" type="MeshInstance3D" parent="RenderScreen"]
visible = false
material_override = SubResource("StandardMaterial3D_urje4")
mesh = SubResource("QuadMesh_lfbep")

[node name="BRBSubviewport" type="SubViewport" parent="RenderScreen"]
size = Vector2i(1920, 1080)
render_target_update_mode = 4

[node name="VideoStreamPlayer" type="VideoStreamPlayer" parent="RenderScreen/BRBSubviewport"]
visible = false
offset_right = 40.0
offset_bottom = 40.0
stream = ExtResource("7_6872q")
autoplay = true
loop = true

[node name="ScryCamSubviewport" type="SubViewport" parent="RenderScreen"]
size = Vector2i(1080, 1080)
render_target_update_mode = 4

[node name="UI" type="CanvasLayer" parent="."]

[connection signal="message_received" from="StreamBotConnector" to="GameManager" method="OnStreamBot_MessageReceived"]
